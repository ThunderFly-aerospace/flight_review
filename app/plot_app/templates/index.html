
{% include 'header.html' %}


{% if not internal_error %}

{% if is_plot_page %}
<div class="alert alert-primary"> <!-- alternatives: alert-info, alert-primary, alert-secondary -->
  Do you need help with interpreting the plots?
  See <a href="https://docs.px4.io/en/log/flight_review.html" target="_blank" class="alert-link">here</a>.
</div>
{% endif %}

{{ title_html }}
{{ hardfault_html }}
{{ info_table_html }}
{{ corrupt_log_html }}
{{ error_labels_html }}

{% if has_position_data %}

<!-- Mapy.cz map plot -->
<div id="mapid"></div>

<script type="text/javascript" src="https://api.mapy.cz/loader.js"></script>
<script type="text/javascript">Loader.load();</script>

<script>
var pos_datas = {{ pos_datas }}; // list of [lat, lon] coordinates
var pos_flight_modes = {{ pos_flight_modes }}; // list of [color, index of pos_datas]
var waypoint_bounds = [];

var center = SMap.Coords.fromWGS84(14.41790, 50.12655);
var m = new SMap(JAK.gel("mapid"), center, 13);
m.addDefaultLayer(SMap.DEF_BASE).enable();
m.addDefaultControls();

var layer = new SMap.Layer.Geometry();
m.addLayer(layer);
layer.enable();

for(var j=0; j<pos_flight_modes.length - 1; j++) 
{
  var offset = -1;
  if(pos_flight_modes[j][1] == 0)
    offset = 0;
  var waypoint_polyline = pos_datas.slice(pos_flight_modes[j][1] + offset, pos_flight_modes[j+1][1]);
  var cur_flight_color = pos_flight_modes[j][0];

  var points = waypoint_polyline.map(function(e) 
                            { 
                              return SMap.Coords.fromWGS84(e[1],e[0]);
                            });

  var options = {
      color: cur_flight_color,
      width: 5
       }

  var polyline = new SMap.Geometry(SMap.GEOMETRY_POLYLINE, null, points, options);
  layer.addGeometry(polyline);

}


//zoom to all
var allpoints = pos_datas.map(function(e) 
                            { 
                              return SMap.Coords.fromWGS84(e[1],e[0]);
                            });
var alloptions = {
      color: "#f00",
      width: 5
       }
var allpolyline = new SMap.Geometry(SMap.GEOMETRY_POLYLINE, null, allpoints, options);
var center=allpolyline.computeCenterZoom(m, false);
m.setCenterZoom(center[0],center[1],false);

</script>

{% endif %}

{% if is_plot_page %}

<div id="loading-plots"><p><big><br/>Loading Plots...</big><br/></p></div>
{% endif %}

{{ plot_div|indent(8) }}

{{ additional_info }}

{% endif %} {# internal_error #}


{% include 'footer.html' %}

</body>
</html>
